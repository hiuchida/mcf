<?xml version="1.0" encoding="UTF-8"?>

<!-- ==================================================================== -->
<!-- Build script for mcfsrv                                              -->
<!-- ==================================================================== -->

<project name="mcfsrv" default="dist.mcfsrv" basedir=".">

  <property file="${basedir}/build.properties" />

  <property name="debug"                    value="true"/>
  <property name="optimize"                 value="true"/>
  <property name="deprecation"              value="false"/>

  <property name="antwork.home"             value="${basedir}/antwork"/>
  <property name="build.home"               value="${antwork.home}/build"/>
  <property name="dist.home"                value="${antwork.home}/dist"/>
  <property name="src.home"                 value="${basedir}/src"/>
  <property name="WebContent.home"          value="${basedir}/WebContent"/>

  <path id="cp.mcfsrv">
    <fileset dir="${WebContent.home}/WEB-INF/lib">
      <include name="*.jar"/>
    </fileset> 
    <fileset dir="../lib">
      <include name="*.jar"/>
    </fileset> 
    <fileset dir="../mcflib/antwork">
      <include name="*.jar"/>
    </fileset> 
  </path>

  <target name="clean.mcfsrv" depends="">
    <delete file="${antwork.home}/mcfsrv.war"/>
    <delete dir="${build.home}"/>
    <delete dir="${dist.home}"/>
  </target>

  <target name="prepare.mcfsrv" depends="clean.mcfsrv">
    <mkdir dir="${antwork.home}"/>
    <mkdir dir="${build.home}"/>
    <mkdir dir="${dist.home}"/>
  </target>

  <target name="compile.mcfsrv" depends="prepare.mcfsrv">
    <javac destdir="${build.home}"
          encoding="UTF-8"
      classpathref="cp.mcfsrv"
             debug="${debug}"
          optimize="${optimize}"
       deprecation="${deprecation}">
      <src path="${src.home}" />
      <include name="**/*.java" />
    </javac>
    <copy todir="${build.home}" preservelastmodified="true">
      <fileset dir="${src.home}" includes="log4j2.xml"/>
    </copy>
  </target>

  <target name="dist.mcfsrv" depends="compile.mcfsrv">
    <copy todir="${dist.home}/mcfsrv">
      <fileset dir="${WebContent.home}" includes="**"/>
    </copy>
    <copy todir="${dist.home}/mcfsrv/WEB-INF/classes">
      <fileset dir="${build.home}" includes="**" />
    </copy>
    <copy todir="${dist.home}/mcfsrv/WEB-INF/lib">
      <fileset dir="../mcflib/antwork" includes="*.jar" />
    </copy>
    <jar jarfile="${antwork.home}/mcfsrv.war" basedir="${dist.home}/mcfsrv" includes="**"/>
  </target>

</project>
